<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>MySQL(4) | CodeSpace</title><meta name="keywords" content="MySQL"><meta name="author" content="Charlie"><meta name="copyright" content="Charlie"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="23、使用存储过程存储过程大部分的sql操作都需要我们使用很多条语句才可以完成。执行这一类操作时，具体的代码会根据数据库内容而发生变化。我们可以单独执行每一条语句，再根据结果去执行其他的语句。也可以创建一个存储过程。简单来说，存储过程就是为以后的使用而保存的一条或者多条MySQL语句。 为什么要使用存储过程 把处理封装在而容易使用的单元中，简化复杂的操作 如果所有的开发人员都使用同一存储过程，则所">
<meta property="og:type" content="article">
<meta property="og:title" content="MySQL(4)">
<meta property="og:url" content="https://charlieblog.top/2021/11/30/MySQL-4/index.html">
<meta property="og:site_name" content="CodeSpace">
<meta property="og:description" content="23、使用存储过程存储过程大部分的sql操作都需要我们使用很多条语句才可以完成。执行这一类操作时，具体的代码会根据数据库内容而发生变化。我们可以单独执行每一条语句，再根据结果去执行其他的语句。也可以创建一个存储过程。简单来说，存储过程就是为以后的使用而保存的一条或者多条MySQL语句。 为什么要使用存储过程 把处理封装在而容易使用的单元中，简化复杂的操作 如果所有的开发人员都使用同一存储过程，则所">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://charlieblog.top/2021/11/30/MySQL-4/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg">
<meta property="article:published_time" content="2021-11-30T02:53:57.000Z">
<meta property="article:modified_time" content="2021-11-30T13:05:51.606Z">
<meta property="article:author" content="Charlie">
<meta property="article:tag" content="MySQL">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://charlieblog.top/2021/11/30/MySQL-4/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg"><link rel="shortcut icon" href="/img/chevron-double-up.svg"><link rel="canonical" href="https://charlieblog.top/2021/11/30/MySQL-4/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'MySQL(4)',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-11-30 21:05:51'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">42</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">6</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 历史</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2021/11/30/MySQL-4/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">CodeSpace</a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 历史</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">MySQL(4)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon fas fa-history"></i><span class="post-meta-label">更新于</span><time datetime="2021-11-30T13:05:51.606Z" title="更新于 2021-11-30 21:05:51">2021-11-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/MySQL/">MySQL</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">4.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>14分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="MySQL(4)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="23、使用存储过程"><a href="#23、使用存储过程" class="headerlink" title="23、使用存储过程"></a>23、使用存储过程</h1><h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>大部分的sql操作都需要我们使用很多条语句才可以完成。执行这一类操作时，具体的代码会根据数据库内容而发生变化。我们可以单独执行每一条语句，再根据结果去执行其他的语句。也可以创建一个存储过程。简单来说，存储过程就是为以后的使用而保存的一条或者多条MySQL语句。</p>
<h2 id="为什么要使用存储过程"><a href="#为什么要使用存储过程" class="headerlink" title="为什么要使用存储过程"></a>为什么要使用存储过程</h2><ul>
<li>把处理封装在而容易使用的单元中，简化复杂的操作</li>
<li>如果所有的开发人员都使用同一存储过程，则所使用的代码都是相同的，这样可以防止出错</li>
<li>简化对于变动的管理。只需要更改存储过程的代码即可</li>
<li>提高性能</li>
<li>存在一些只能用在单个请求中的MySQL元素和特性，存储过程可以使用它们来编写功能更强大的代码</li>
<li>编写困难</li>
<li>可能没有创建存储过程的权限</li>
</ul>
<h2 id="使用存储过程"><a href="#使用存储过程" class="headerlink" title="使用存储过程"></a>使用存储过程</h2><h3 id="执行存储过程"><a href="#执行存储过程" class="headerlink" title="执行存储过程"></a>执行存储过程</h3><p>MySQL称存储过程的执行为调用，因此MySQL执行存储过程的语句为call。call接受存储过程的名字以及需要传递给他的任意参数。（多少有点函数的意思）</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130110521092.png" alt="image-20211130110521092"></p>
<p>这是一个调用</p>
<h3 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h3><p><img src="/2021/11/30/MySQL-4/image-20211130132218091.png" alt="image-20211130132218091"></p>
<p>使用create procedure创建了一个存储过程，如果这个过程需要参数，会在括号之中列出来。begin和end限定存储过程提。过程本身仅仅是一个select</p>
<blockquote>
<p>要注意的是，如果您这样编写代码：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130112343388.png" alt="image-20211130112343388"></p>
<p>在输入完MySQL命令之前，就会报错。因为MySQL的分隔符为 ；。这将会导致无法正常创建存储过程。解决办法是临时改变语句分隔符。（delimiter //）要记得在创建完毕之后修改回正常的</p>
</blockquote>
<h3 id="删除存储过程"><a href="#删除存储过程" class="headerlink" title="删除存储过程"></a>删除存储过程</h3><p>一句简单的drop procedure即可</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130132308816.png" alt="image-20211130132308816"></p>
<h3 id="使用参数"><a href="#使用参数" class="headerlink" title="使用参数"></a>使用参数</h3><p>productpricing简单的显示select语句的结果。一般存储过程并不显示结果，而是把结果返回给你指定的变量。</p>
<p>下面是product pricing的修改版本：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130132657966.png" alt="image-20211130132657966"></p>
<p>接受三个参数pl，ph，pa，这三个参数都是<strong>out</strong>类型，也就是用来从存储过程传出一个值。还有<strong>in</strong>类型（传递给存储过程）和<strong>inout</strong>（传入传出）的参数。想要调用这个函数也很简单，只需要：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130132709340.png" alt="image-20211130132709340"></p>
<blockquote>
<p>MySQL所有的变量都必须以@开始</p>
</blockquote>
<p>要查看这些变量的值，可以：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130132735404.png" alt="image-20211130132735404"></p>
<p>如果想要获得三个值：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130132812898.png" alt="image-20211130132812898"></p>
<p>接下爱是另外一个例子，使用in 和 out：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130133011326.png" alt="image-20211130133011326"></p>
<p>订单号被定义为in，传入存储过程。</p>
<p>调用一下试试：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130133111933.png" alt="image-20211130133111933"></p>
<h3 id="建立智能存储过程"><a href="#建立智能存储过程" class="headerlink" title="建立智能存储过程"></a>建立智能存储过程</h3><p>以上的例子其实没有必要封装为存储过程。在更加繁杂的地方才会显现出存储过程的威力。</p>
<p>假设我们需要获得与以前一样的订单合计，但是需要对合计增加营业税，不过只针对某些顾客，那么：</p>
<ul>
<li>获得合计</li>
<li>把营业税有条件的加到合计</li>
<li>返回合计</li>
</ul>
<p>那么：（使用了jetbrains的datagrip，不得不说，jb yyds）</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130140329308.png" alt="image-20211130140329308"></p>
<p>首先这个过程我们增加了注释（–加上一个空格。）</p>
<p>添加了一个布尔值变量taxable，使用declare定义了两个局部变量。declare要求指定变量名和数据类型，也支持可选的默认值（这里被设置为6%）其他的都很好懂。</p>
<blockquote>
<p>comment语句不是必须的，他会在show procedure status之后给显示：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130140714137.png" alt="image-20211130140714137"></p>
</blockquote>
<p>我们试验一下这个存储过程：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130140821847.png" alt="image-20211130140821847"></p>
<p><img src="/2021/11/30/MySQL-4/image-20211130140842208.png" alt="image-20211130140842208"></p>
<h3 id="检查存储过程"><a href="#检查存储过程" class="headerlink" title="检查存储过程"></a>检查存储过程</h3><p>只需要show create procedure即可。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130140925673.png" alt="image-20211130140925673"></p>
<hr>
<h1 id="24、使用游标"><a href="#24、使用游标" class="headerlink" title="24、使用游标"></a>24、使用游标</h1><h2 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h2><p>MySQL返回的是某一行或多行，游标就是方便我们寻找这一行的下几行或者上几行的机制。</p>
<p>游标（cursor）是一个存储在MySQL服务器上的数据库查询，不是一条select语句，而是被该语句检索出来的结果集。在存储了游标之后，应用程序可以根据需要滚动或浏览其中的数据。</p>
<blockquote>
<p>MySQL游标只能用于存储过程</p>
</blockquote>
<h2 id="使用游标"><a href="#使用游标" class="headerlink" title="使用游标"></a>使用游标</h2><ul>
<li>在使用前，必须声明它。只是定义要使用的select语句</li>
<li>一旦声明后，必须打开游标以供使用。这个过程用前面定义的select语句把数据实际检索出来</li>
<li>对于填有数据的游标，根据需要取出各行</li>
<li>结束时，必须关闭游标</li>
</ul>
<h3 id="创建游标"><a href="#创建游标" class="headerlink" title="创建游标"></a>创建游标</h3><p>使用declare定义游标，并定义点供应的select语句，根据需要带where子句和其他：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130141830971.png" alt="image-20211130141830971"></p>
<blockquote>
<p> 这个存储过程之中的游标在存储过程处理完毕之后就会消失。</p>
</blockquote>
<h3 id="打开和关闭游标"><a href="#打开和关闭游标" class="headerlink" title="打开和关闭游标"></a>打开和关闭游标</h3><p><img src="/2021/11/30/MySQL-4/image-20211130142019112.png" alt="image-20211130142019112"></p>
<p>在定义之后可以使用open和close来进行打开和关闭游标。</p>
<h3 id="使用游标数据"><a href="#使用游标数据" class="headerlink" title="使用游标数据"></a>使用游标数据</h3><p>在游标打开之后可以使用fetch语句分别访问每一行。fetch指定检索什么数据，检索出阿里的数据存储在什么地方。它还可以向前移动内部行指针，使得下一条fetch语句检索下一行。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130142333992.png" alt="image-20211130142333992"></p>
<p>这个例子从游标中检索单个行，默认从第一行开始存储到一个o的局部变量之中，对数据不做处理。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130142656754.png" alt="image-20211130142656754"></p>
<p>这个例子使用fetch检索当前order_num到声明的名为o的变量中。但与前一个例子不一样的是，这个例子中的fetch在不断的repeat，因此它反复执行直到done为真（由until done end repeat规定）。为了使它起作用，用一个default 0（假，不结束）定义done。而为了让done为真，需要使用以下语句：</p>
<p><code>declare continue handler for sqlstate &#39;02000&#39; set done = 1;</code></p>
<p>这个语句定义了一个continue handler，它是在条件出现时被执行的代码。这里指出当sqlstate’02000’出现时，set done = 1。sqlstate ‘02000’是一个<strong>未找到</strong>条件，当repeat由于没有更多的行供循环而不能继续时，出现这个条件。</p>
<blockquote>
<p>declare语句有特定的顺序。用declare语句定义的局部变量必须定义在游标语句或者句柄之前，而句柄必须在游标之后定义。</p>
</blockquote>
<p>下面是更进一步的修改：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130151617976.png" alt="image-20211130151617976"></p>
<p>这里我们增加了一个名为t的变量，我们还创建了一个新的表。语句都很容易理解。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130151936202.png" alt="image-20211130151936202"></p>
<hr>
<h1 id="25、使用触发器"><a href="#25、使用触发器" class="headerlink" title="25、使用触发器"></a>25、使用触发器</h1><h2 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h2><p>MySQL语句在需要时被执行，存储过程也是这样。但是如果想要某些语句在事件发生时自动执行，就需要触发器了。<strong>触发器</strong>是MySQL相应以下语句而自动执行的一条MySQL语句（或者位于begin和end语句之间的一组语句）</p>
<ul>
<li>delete</li>
<li>insert</li>
<li>update</li>
</ul>
<h2 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h2><p>创建触发器需要四条信息：</p>
<ul>
<li>唯一的触发器名</li>
<li>触发器关联的表</li>
<li>触发器应该相应的活动</li>
<li>触发器何时执行（处理之前或之后）</li>
</ul>
<blockquote>
<p>最好在数据库范围内使用唯一的触发器名</p>
</blockquote>
<p>触发器使用create trigger来创建：</p>
<p>（书中的代码已经不能被使用，我稍作修改）</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130152807598.png" alt="image-20211130152807598"></p>
<p>接下来我们看一看这个ret之中有什么：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130152843600.png" alt="image-20211130152843600"></p>
<p>我们在products之中插入一条语句试试：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130153244036.png" alt="image-20211130153244036"></p>
<p>可以看到有了我们想要的值。</p>
<p>触发器按照每个事件每个表每次定义，也就是一个表最多六个触发器</p>
<h2 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h2><p><img src="/2021/11/30/MySQL-4/image-20211130153847572.png" alt="image-20211130153847572"></p>
<h2 id="使用触发器"><a href="#使用触发器" class="headerlink" title="使用触发器"></a>使用触发器</h2><h3 id="insert触发器"><a href="#insert触发器" class="headerlink" title="insert触发器"></a>insert触发器</h3><ul>
<li>在insert触发器代码内，可以引用一个名为new的虚拟表，访问被插入的行</li>
<li>在before insert触发器中，new的值也可以被更新（允许更改被插入的值）</li>
<li>对于auto_increment列，new在insert执行之前包含0，在insert之后包含新的自动生成值</li>
</ul>
<p><img src="/2021/11/30/MySQL-4/image-20211130154138235.png" alt="image-20211130154138235"></p>
<p>这个代码创建了一个neworder触发器，每次insert之后都会生成一个订单号并保存在ret之中。这个触发器必须在insert之后，因为insert之前还没有这个order_num。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130154456309.png" alt="image-20211130154456309"></p>
<h3 id="delete触发器"><a href="#delete触发器" class="headerlink" title="delete触发器"></a>delete触发器</h3><ul>
<li>在delete触发器代码内部，可以引用一个old的虚拟表，访问被删除的行</li>
<li>old中的值是只读的，不能更新。</li>
</ul>
<p><img src="/2021/11/30/MySQL-4/image-20211130155156775.png" alt="image-20211130155156775"></p>
<blockquote>
<p>需要首先创建一个和orders一样列的表</p>
</blockquote>
<p>这个触发器将在任意订单被删除前执行。它会将要被删除的订单保存在一个名为archive_orders的存档表中</p>
<blockquote>
<p>使用before delete的优点是如果因为某种原因订单不能存档，那么delete将被抛弃。</p>
</blockquote>
<h3 id="update触发器"><a href="#update触发器" class="headerlink" title="update触发器"></a>update触发器</h3><ul>
<li>update触发器代码中可以访问一个名为old的虚拟表访问以前的值，引用一个名为new的虚拟表访问新更新的值</li>
<li>在before update 触发器中，new的值可能也被更新</li>
<li>old的值是只读的，不会被更新</li>
</ul>
<p>下面这个例子保证州名缩写总是大写：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130155625991.png" alt="image-20211130155625991"></p>
<hr>
<h1 id="26、管理事务处理"><a href="#26、管理事务处理" class="headerlink" title="26、管理事务处理"></a>26、管理事务处理</h1><h2 id="事务处理"><a href="#事务处理" class="headerlink" title="事务处理"></a>事务处理</h2><p>事务处理可以用来维护数据库的完整性，它保证成批的MySQL操作要么完全执行要么完全不执行。</p>
<p>对于orders和orderitems这两个表来说，orders保存实际订单，orderitems存储订购的物品，通过custid来进行关联。给这个系统添加一个订单的过程如下：</p>
<ol>
<li>检查数据库中是否有相应的客户，如果不存在，添加</li>
<li>检索客户的id</li>
<li>…</li>
</ol>
<p>现在假如数据库出现问题，可能执行到一半就停止执行了。也就是可能会出现不完整的数据。这个时候就是<strong>事务处理</strong>的事情了。<strong>事务处理</strong>是一种管理成批执行的MySQL机制，保证数据库不包含不完整的操作结果。（类似于不会被中断？）如果发生错误会进行回退，如果未发生错误哦将提交给数据库。</p>
<blockquote>
<ul>
<li><strong>事务</strong>指的是一组sql语句</li>
<li><strong>回退</strong>指撤销指定sql语句的过程</li>
<li><strong>提交</strong>指将为存储的sql语句结果写入数据库表</li>
<li><strong>保留点</strong>指事务处理设置的临时占位符，可以对他发布会退。</li>
</ul>
</blockquote>
<h2 id="控制事务处理"><a href="#控制事务处理" class="headerlink" title="控制事务处理"></a>控制事务处理</h2><p>管理事务处理的关键在于将MySQL语句组分解为逻辑块，并且明确规定数据何时应该回退，何时不回退。</p>
<p>使用<code>start transaction</code>来标识事务的开始。</p>
<h3 id="使用rollback"><a href="#使用rollback" class="headerlink" title="使用rollback"></a>使用rollback</h3><p>用于回退MySQL语句</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130170131195.png" alt="image-20211130170131195"></p>
<p>看结果：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130172108788.png" alt="image-20211130172108788"></p>
<p><img src="/2021/11/30/MySQL-4/image-20211130172115318.png" alt="image-20211130172115318"></p>
<p><img src="/2021/11/30/MySQL-4/image-20211130172122075.png" alt="image-20211130172122075"></p>
<p><img src="/2021/11/30/MySQL-4/image-20211130171935460.png" alt="image-20211130171935460"></p>
<p>大致的流程画了以下，应该是这个意思。</p>
<blockquote>
<p>事务管理只能回退insert update和delete语句，也不能回退create和drop语句。</p>
</blockquote>
<h3 id="使用commit"><a href="#使用commit" class="headerlink" title="使用commit"></a>使用commit</h3><p>一般的MySQL语句都会自动提交，但是在事务处理之中，提交需要我们明确的提交。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130173735050.png" alt="image-20211130173735050"></p>
<p>我不知道为什么报了一个奇怪的错误：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130173759243.png" alt="image-20211130173759243"></p>
<p>但是这个最后的commit仅在不出错时写出更改，如果第一个成功第二个失败那么delete不会提交。</p>
<h3 id="使用保留点"><a href="#使用保留点" class="headerlink" title="使用保留点"></a>使用保留点</h3><p>简单的rollback和commit可以写入或撤销整个事务处理，但是更复杂的事务处理需要部分提交或回退</p>
<p>为了支持部分事务回退，必须能在事务处理块中合适的位置防止占位符。</p>
<p>可以使用savepoint语句：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130174358107.png" alt="image-20211130174358107"></p>
<p>想要回退时只需要：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130174406319.png" alt="image-20211130174406319"></p>
<blockquote>
<p>保留点越多越好</p>
</blockquote>
<h3 id="更改默认的提交行为"><a href="#更改默认的提交行为" class="headerlink" title="更改默认的提交行为"></a>更改默认的提交行为</h3><p>默认的MySQL行为是自动提交所有更改。为了指示MySQL不自动提交，可以这样：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130174506083.png" alt="image-20211130174506083"></p>
<hr>
<h1 id="27、全球化和本地化"><a href="#27、全球化和本地化" class="headerlink" title="27、全球化和本地化"></a>27、全球化和本地化</h1><h2 id="字符集和校对顺序"><a href="#字符集和校对顺序" class="headerlink" title="字符集和校对顺序"></a>字符集和校对顺序</h2><ul>
<li><strong>字符集</strong>为字母和符号的集合</li>
<li><strong>编码</strong>为某个字符集成员的内部表示</li>
<li><strong>校对</strong>为规定字符如何比较的指令</li>
</ul>
<h2 id="使用字符集和校对顺序"><a href="#使用字符集和校对顺序" class="headerlink" title="使用字符集和校对顺序"></a>使用字符集和校对顺序</h2><p>为查看所支持的字符集完整列表，使用：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130174745840.png" alt="image-20211130174745840"></p>
<p>这条语句显示所有可用的字符集以及每个字符集的描述和默认校对</p>
<p>为查看所支持校对的完整列表：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130174815520.png" alt="image-20211130174815520"></p>
<p>这个语句显示所有可用的校对，以及他们适用的字符集。可以看到字符集不一定只有一种校对。</p>
<p>通常在安装系统管理是定义一个默认的字符集和校对。也可与i在创建数据库时指定默认的字符集和校对。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130175113146.png" alt="image-20211130175113146"></p>
<p><img src="/2021/11/30/MySQL-4/image-20211130175126491.png" alt="image-20211130175126491"></p>
<p>在创建表或者列的时候可以指定字符集和校对，可以使用带子句的create table</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130175324253.png" alt="image-20211130175324253"></p>
<ul>
<li>如果制定了character set和collate，那么使用</li>
<li>如果仅仅指定character set，那么使用这个字符集和它默认的校对</li>
<li>否则使用数据库默认</li>
</ul>
<p>也可以指定某一列的字符集和校对</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130175629684.png" alt="image-20211130175629684"></p>
<p>校对在排序时起到了重要的作用，如果需要用与创建表时不同的校对顺序特定的select语句，可以在select中进行：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130175803636.png" alt="image-20211130175803636"></p>
<p>这个select使用collate指定一个备用的校对顺序。</p>
<blockquote>
<p>如果需要，串可以在字符集之间转换，只需要 cast或者convert函数即可</p>
</blockquote>
<hr>
<h1 id="28、安全管理"><a href="#28、安全管理" class="headerlink" title="28、安全管理"></a>28、安全管理</h1><h2 id="访问控制"><a href="#访问控制" class="headerlink" title="访问控制"></a>访问控制</h2><p>MySQL服务器的安全基础是：<strong>用户应该对他们需要的数据具有适当的访问权，既不能多也不能少。</strong></p>
<p>我们一直是使用root登录，但是在实际应用中一定要分配更多的账号。</p>
<h2 id="管理用户"><a href="#管理用户" class="headerlink" title="管理用户"></a>管理用户</h2><p>MySQL用户账户和信息存储在名为mysql的MySQL数据库中。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130194918937.png" alt="image-20211130194918937"></p>
<h3 id="创建用户账号"><a href="#创建用户账号" class="headerlink" title="创建用户账号"></a>创建用户账号</h3><p><img src="/2021/11/30/MySQL-4/image-20211130195059696.png" alt="image-20211130195059696"></p>
<p>第一条语句创建了一个新用户账户。在创建时不一定需要给出口令，但是这里给出了。（identified by）</p>
<blockquote>
<p>identified by 指定的口令为纯文本，MySQL将在保存到user之前对其进行加密。为了作为散列值指定口令，使用identified by  password。</p>
</blockquote>
<blockquote>
<p>同样可以使用grant（稍后介绍）或者insert（不建议）来进行创建用户账号。</p>
</blockquote>
<p>rename user可以重命名用户：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130195435570.png" alt="image-20211130195435570"></p>
<h3 id="删除用户账号"><a href="#删除用户账号" class="headerlink" title="删除用户账号"></a>删除用户账号</h3><p><img src="/2021/11/30/MySQL-4/image-20211130195504057.png" alt="image-20211130195504057"></p>
<h3 id="设置访问权限"><a href="#设置访问权限" class="headerlink" title="设置访问权限"></a>设置访问权限</h3><p>使用show grants for将会看到赋予用户账号的权限。</p>
<p>此结果表示在任意数据库和任意表上对任何东西没有权限。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130195619039.png" alt="image-20211130195619039"></p>
<blockquote>
<p>用户定义为user@host。MySQL的权限用用户名和主机名结合定义。如果不指定主机名，就用%来代替。</p>
</blockquote>
<p>要设置权限，使用grant语句，需要给出以下信息：</p>
<ul>
<li>要授予的权限</li>
<li>被授予访问权限的数据库或表</li>
<li>用户名</li>
</ul>
<p><img src="/2021/11/30/MySQL-4/image-20211130195946980.png" alt="image-20211130195946980"></p>
<p>例如这个，允许ben在demo的所有表上使用select。只有这样ben才能对于demo有读权限。</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130200046381.png" alt="image-20211130200046381"></p>
<p>使用revoke来撤销特定的权限：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130200144330.png" alt="image-20211130200144330"></p>
<p>grant和revoke可以在几个层次上控制访问权限：</p>
<ul>
<li>整个服务器，grant all和revoke all</li>
<li>整个数据库，on database.*</li>
<li>特定的表，on database.table</li>
<li>特定的列</li>
<li>特定的存储过程</li>
</ul>
<p>下面是权限表：</p>
<table>
<thead>
<tr>
<th align="center">权限</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">ALL</td>
<td align="center">除GRANT OPTION外的所有权限</td>
</tr>
<tr>
<td align="center">ALTER</td>
<td align="center">使用ALTER TABLE</td>
</tr>
<tr>
<td align="center">ALTER ROUTINE</td>
<td align="center">使用ALTER PROCEDURE和DROP PROCEDURE</td>
</tr>
<tr>
<td align="center">CREATE</td>
<td align="center">使用CREATE TABLE</td>
</tr>
<tr>
<td align="center">CREATE ROUTINE</td>
<td align="center">使用CREATE PROCEDURE</td>
</tr>
<tr>
<td align="center">CREATE TEMPORARY TABLES</td>
<td align="center">使用CREATE TEMPORARY TABLE</td>
</tr>
<tr>
<td align="center">CREATE USER</td>
<td align="center">使用CREATE USER、DROP USER、RENAME USER和REVOKE ALL PRIVILEGES</td>
</tr>
<tr>
<td align="center">CREATE VIEW</td>
<td align="center">使用CREATE VIEW</td>
</tr>
<tr>
<td align="center">DELETE</td>
<td align="center">使用DELETE</td>
</tr>
<tr>
<td align="center">DROP</td>
<td align="center">使用DROP TABLE</td>
</tr>
<tr>
<td align="center">EXECUTE</td>
<td align="center">使用CALL和存储过程</td>
</tr>
<tr>
<td align="center">FILE</td>
<td align="center">使用SELECT INTO OUTFILE和LOAD DATA INFILE</td>
</tr>
<tr>
<td align="center">GRANT OPTION</td>
<td align="center">使用GRANT和REVOKE</td>
</tr>
<tr>
<td align="center">INDEX</td>
<td align="center">使用CREATE INDEX和DROP INDEX</td>
</tr>
<tr>
<td align="center">INSERT</td>
<td align="center">使用INSERT</td>
</tr>
<tr>
<td align="center">LOCK TABLES</td>
<td align="center">使用LOCK TABLES</td>
</tr>
<tr>
<td align="center">PROCESS</td>
<td align="center">使用SHOW FULL PROCESSLIST</td>
</tr>
<tr>
<td align="center">RELOAD</td>
<td align="center">使用FLUSH</td>
</tr>
<tr>
<td align="center">REPLICATION CLIENT</td>
<td align="center">服务器位置的访问</td>
</tr>
<tr>
<td align="center">REPLICATION SLAVE</td>
<td align="center">由复制从属使用</td>
</tr>
<tr>
<td align="center">SELECT</td>
<td align="center">使用SELECT</td>
</tr>
<tr>
<td align="center">SHOW DATABASES</td>
<td align="center">使用SHOW DATABASES</td>
</tr>
<tr>
<td align="center">SHOW VIEW</td>
<td align="center">使用SHOW CREATE VIEW</td>
</tr>
<tr>
<td align="center">SHUTDOWN</td>
<td align="center">使用mysqladmin shutdown（用来关闭MySQL）</td>
</tr>
<tr>
<td align="center">SUPER</td>
<td align="center">使用CHANGE MASTER、KILL、LOGS、PURGE、MASTER和SET GLOBAL。还允许mysqladmin调试登录</td>
</tr>
<tr>
<td align="center">UPDATE</td>
<td align="center">使用UPDATE</td>
</tr>
<tr>
<td align="center">USAGE</td>
<td align="center">无访问权限</td>
</tr>
</tbody></table>
<blockquote>
<p>在使用grant和revoke时，用户账号必须存在，但是并不要求所涉及的多项必须存在。副作用是进士将来表被删除或者被重建，该账户仍会有这些权限。</p>
<p>多个grant语句可以合并为一个，只需要将各权限之间使用都好分隔即可。</p>
</blockquote>
<h3 id="更改口令"><a href="#更改口令" class="headerlink" title="更改口令"></a>更改口令</h3><p>set password：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130204228271.png" alt="image-20211130204228271"></p>
<p>不太理解为什么这个一直在报错，，，，</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130204244812.png" alt="image-20211130204244812"></p>
<p><img src="/2021/11/30/MySQL-4/image-20211130204510253.png" alt="image-20211130204510253"></p>
<p>查了以下官方文档，好像是不能加一个password的原因。</p>
<hr>
<h1 id="29、数据库维护"><a href="#29、数据库维护" class="headerlink" title="29、数据库维护"></a>29、数据库维护</h1><h2 id="备份数据"><a href="#备份数据" class="headerlink" title="备份数据"></a>备份数据</h2><ul>
<li>使用mysqldump转出所有数据库内容到某个外部文件。在进行常规备份前这个实用程序应该正常运行，以便正确的备份转储文件。</li>
<li>可以使用mysqlhotcopy从一个数据库复制所有的数据</li>
<li>可以使用MySQL的backup table或者select into outfile转出所有数据到某个外部文件。这两条语句都接受将要创建的系统文件名，此文件必须存在，可以使用restore来复原</li>
</ul>
<h2 id="进行数据库维护"><a href="#进行数据库维护" class="headerlink" title="进行数据库维护"></a>进行数据库维护</h2><ul>
<li><p>analyze table，用来检查表键是够正确：</p>
<p><img src="/2021/11/30/MySQL-4/image-20211130204955154.png" alt="image-20211130204955154"></p>
</li>
<li><p>check table用来针对许多问题对表进行检查。check table支持一系列的用于myisam表的方式：</p>
<ul>
<li>changed检查自最后一次检查以来改动的表</li>
<li>extended执行最彻底的检查</li>
<li>fast只检查未正常关闭的表</li>
<li>medium检查所有被删除的连接并进行键检验</li>
<li>quick只进行快速扫描</li>
</ul>
<p><img src="/2021/11/30/MySQL-4/image-20211130205246383.png" alt="image-20211130205246383"></p>
</li>
<li><p>如果myisam表访问产生不正确和不一致的结果，可能需要用repair table来修复相应的表。这条语句不应该被经常使用，否则应该是存在更大的问题。</p>
</li>
<li><p>如果从一个表中删除大量数据，应该使用optimize table来回收所用的空间，从而优化表的性能</p>
</li>
</ul>
<h2 id="查看日志文件"><a href="#查看日志文件" class="headerlink" title="查看日志文件"></a>查看日志文件</h2><p>主要的日志文件：</p>
<ul>
<li>错误日志：包含启动和关闭问题以及任意关键错误的细节，名为hostname.rar，位于data目录，可以使用–log-error更改名字</li>
<li>查询日志。记录所有MySQL活动。这个日志文件可能很快就会变得很大。位于data中的hostname.log，可以使用 –log更改名字</li>
<li>二进制日志。记录更新过数据的所有语句。名为hostname-bin，位于data，可以使用–log-bin来更改名字</li>
<li>缓慢查询日志。记录执行缓慢的任何查询。用于优化数据库。名为hostname-slow.log，位于data，可以使用–log-slow-queries命令行更改。</li>
</ul>
<hr>
<h1 id="30、改善性能"><a href="#30、改善性能" class="headerlink" title="30、改善性能"></a>30、改善性能</h1><ul>
<li>MySQL是多线程的，查询任务中任意一个执行缓慢都会影响到其他的查询</li>
<li>select可以有多种查询方式，请找到最好的。</li>
<li>使用explain语句让MySQL解释他如何执行一条select</li>
<li>存储过程中的语句执行起来比分开执行更快</li>
<li>要使用正确的数据类型</li>
<li>尽量不要使用select * </li>
<li>有的操作支持delayed，如果使用它，将把控制立即返回给调用程序，并且一旦有可能就实际执行该操作。</li>
<li>在导入数据时，应该关闭自动提交</li>
<li>必须索引数据库表以改善数据检索的性能</li>
<li>select中存在多条or时，使用union可能会更快</li>
<li>如果有一些表只收集数据且不常被搜索，可以不索引。索引会损害插入、删除和更新的性能</li>
<li>like很慢，使用fulltext</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Charlie</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://charlieblog.top/2021/11/30/MySQL-4/">https://charlieblog.top/2021/11/30/MySQL-4/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://charlieblog.top" target="_blank">CodeSpace</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/MySQL/">MySQL</a></div><div class="post_share"><div class="social-share" data-image="/2021/11/30/MySQL-4/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/11/28/MySQL-3/"><img class="prev-cover" src="/2021/11/28/MySQL-3/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">MySQL(3)</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/30/MySQL%E8%AF%AD%E6%B3%95/"><img class="next-cover" src="/2021/11/30/MySQL%E8%AF%AD%E6%B3%95/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">MySQL语法</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/11/26/MySQL-1/" title="MySQL(1)"><img class="cover" src="/2021/11/26/MySQL-1/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-26</div><div class="title">MySQL(1)</div></div></a></div><div><a href="/2021/11/30/MySQL%E8%AF%AD%E6%B3%95/" title="MySQL语法"><img class="cover" src="/2021/11/30/MySQL%E8%AF%AD%E6%B3%95/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-30</div><div class="title">MySQL语法</div></div></a></div><div><a href="/2021/11/28/MySQL-3/" title="MySQL(3)"><img class="cover" src="/2021/11/28/MySQL-3/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-28</div><div class="title">MySQL(3)</div></div></a></div><div><a href="/2021/11/27/MySQL-2/" title="MySQL(2)"><img class="cover" src="/2021/11/27/MySQL-2/Como-ver-las-consultas-que-se-estan-ejecutando-en-MySQL-professor-falken.com_.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-11-27</div><div class="title">MySQL(2)</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#23%E3%80%81%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">23、使用存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.1.</span> <span class="toc-text">存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.2.</span> <span class="toc-text">为什么要使用存储过程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.</span> <span class="toc-text">使用存储过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A7%E8%A1%8C%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.1.</span> <span class="toc-text">执行存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.2.</span> <span class="toc-text">创建存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">删除存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.4.</span> <span class="toc-text">使用参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BB%BA%E7%AB%8B%E6%99%BA%E8%83%BD%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.5.</span> <span class="toc-text">建立智能存储过程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A3%80%E6%9F%A5%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.6.</span> <span class="toc-text">检查存储过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#24%E3%80%81%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87"><span class="toc-number">2.</span> <span class="toc-text">24、使用游标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B8%B8%E6%A0%87"><span class="toc-number">2.1.</span> <span class="toc-text">游标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87"><span class="toc-number">2.2.</span> <span class="toc-text">使用游标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%B8%B8%E6%A0%87"><span class="toc-number">2.2.1.</span> <span class="toc-text">创建游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%BC%80%E5%92%8C%E5%85%B3%E9%97%AD%E6%B8%B8%E6%A0%87"><span class="toc-number">2.2.2.</span> <span class="toc-text">打开和关闭游标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%B8%B8%E6%A0%87%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.3.</span> <span class="toc-text">使用游标数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#25%E3%80%81%E4%BD%BF%E7%94%A8%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.</span> <span class="toc-text">25、使用触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.1.</span> <span class="toc-text">触发器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.2.</span> <span class="toc-text">创建触发器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.3.</span> <span class="toc-text">删除触发器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.4.</span> <span class="toc-text">使用触发器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#insert%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.4.1.</span> <span class="toc-text">insert触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#delete%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.4.2.</span> <span class="toc-text">delete触发器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#update%E8%A7%A6%E5%8F%91%E5%99%A8"><span class="toc-number">3.4.3.</span> <span class="toc-text">update触发器</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#26%E3%80%81%E7%AE%A1%E7%90%86%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">4.</span> <span class="toc-text">26、管理事务处理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">4.1.</span> <span class="toc-text">事务处理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E4%BA%8B%E5%8A%A1%E5%A4%84%E7%90%86"><span class="toc-number">4.2.</span> <span class="toc-text">控制事务处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8rollback"><span class="toc-number">4.2.1.</span> <span class="toc-text">使用rollback</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8commit"><span class="toc-number">4.2.2.</span> <span class="toc-text">使用commit</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E4%BF%9D%E7%95%99%E7%82%B9"><span class="toc-number">4.2.3.</span> <span class="toc-text">使用保留点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E9%BB%98%E8%AE%A4%E7%9A%84%E6%8F%90%E4%BA%A4%E8%A1%8C%E4%B8%BA"><span class="toc-number">4.2.4.</span> <span class="toc-text">更改默认的提交行为</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#27%E3%80%81%E5%85%A8%E7%90%83%E5%8C%96%E5%92%8C%E6%9C%AC%E5%9C%B0%E5%8C%96"><span class="toc-number">5.</span> <span class="toc-text">27、全球化和本地化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%A0%A1%E5%AF%B9%E9%A1%BA%E5%BA%8F"><span class="toc-number">5.1.</span> <span class="toc-text">字符集和校对顺序</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%AD%97%E7%AC%A6%E9%9B%86%E5%92%8C%E6%A0%A1%E5%AF%B9%E9%A1%BA%E5%BA%8F"><span class="toc-number">5.2.</span> <span class="toc-text">使用字符集和校对顺序</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#28%E3%80%81%E5%AE%89%E5%85%A8%E7%AE%A1%E7%90%86"><span class="toc-number">6.</span> <span class="toc-text">28、安全管理</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">6.1.</span> <span class="toc-text">访问控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"><span class="toc-number">6.2.</span> <span class="toc-text">管理用户</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E8%B4%A6%E5%8F%B7"><span class="toc-number">6.2.1.</span> <span class="toc-text">创建用户账号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%94%A8%E6%88%B7%E8%B4%A6%E5%8F%B7"><span class="toc-number">6.2.2.</span> <span class="toc-text">删除用户账号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AE%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90"><span class="toc-number">6.2.3.</span> <span class="toc-text">设置访问权限</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E6%94%B9%E5%8F%A3%E4%BB%A4"><span class="toc-number">6.2.4.</span> <span class="toc-text">更改口令</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#29%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%B4%E6%8A%A4"><span class="toc-number">7.</span> <span class="toc-text">29、数据库维护</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE"><span class="toc-number">7.1.</span> <span class="toc-text">备份数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E7%BB%B4%E6%8A%A4"><span class="toc-number">7.2.</span> <span class="toc-text">进行数据库维护</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97%E6%96%87%E4%BB%B6"><span class="toc-number">7.3.</span> <span class="toc-text">查看日志文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#30%E3%80%81%E6%94%B9%E5%96%84%E6%80%A7%E8%83%BD"><span class="toc-number">8.</span> <span class="toc-text">30、改善性能</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By Charlie</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css"><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.min.js"></script><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/contrib/copy-tex.css"><script>(() => {
  document.querySelectorAll('#article-container span.katex-display').forEach(item => {
    btf.wrap(item, 'div', { class: 'katex-wrap'})
  })
})()</script><script>if (document.getElementsByClassName('mermaid').length) {
  if (window.mermaidJsLoad) mermaid.init()
  else {
    getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(() => {
      window.mermaidJsLoad = true
      mermaid.initialize({
        theme: 'default',
      })
      false && mermaid.init()
    })
  }
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '',
      appKey: '',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !false) {
  if (false) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/canvas-fluttering-ribbon.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>